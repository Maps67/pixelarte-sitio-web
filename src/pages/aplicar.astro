---
// src/pages/aplicar.astro
// VERSIÓN FORMSpree con AJAX (Definitiva y Gratuita)
import Layout from '../layouts/Layout.astro';
---
<Layout 
  title="Aplicar para Sesión Estratégica | Pixelarte Studio"
  description="Complete esta aplicación para ser considerado para una sesión estratégica confidencial con nuestro fundador."
>
  
  <section class="bg-claro py-16 md:py-24">
    <div class="container max-w-3xl mx-auto px-4 text-center">

      <h1 class="text-4xl md:text-5xl font-playfair font-bold text-oscuro mb-4">
        Aplicación para Sesión Estratégica
      </h1>

      <p class="text-lg text-secundario max-w-2xl mx-auto mb-10">
        Basado en su interés en nuestro "Cuadro de Mando", entendemos que se toma en serio el crecimiento de su clínica.
        <br/><br/>
        Cada mes, nuestro fundador, Marco A. Portillo, revisa personalmente un <strong>número limitado</strong> de cuadros de mando para proporcionar un análisis estratégico confidencial.
        <br/><br/>
        Si desea que su práctica sea <strong>considerada</strong> para una de estas sesiones, por favor, complete la siguiente breve aplicación.
      </p>

      <form 
        id="aplicacion-form"
        action="https://formspree.io/f/xanprqnv" 
        method="POST" 
        class="text-left"
      >
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label for="nombre" class="form-label">Nombre Completo</label>
            <input type="text" id="nombre" name="nombre" class="form-input" required />
          </div>
          <div>
            <label for="email" class="form-label">Email Profesional</label>
            <input type="email" id="email" name="email" class="form-input" required />
          </div>
        </div>
        <div class="mb-6">
          <label for="website" class="form-label">Sitio Web de la Clínica</label>
          <input type="url" id="website" name="website" class="form-input" placeholder="https://..." required />
        </div>
        <div class="mb-6">
          <label for="reto" class="form-label">¿Cuál es su principal reto de crecimiento actual?</label>
          <textarea id="reto" name="reto" rows="4" class="form-input" placeholder="Ej: 'No recibimos suficientes pacientes calificados', 'Mi competencia aparece más en Google', etc."></textarea>
        </div>

        <div class="mb-6">
          <label for="presupuesto" class="form-label">¿Qué presupuesto mensual tiene asignado para marketing? (MXN)</label>
          <select id="presupuesto" name="presupuesto" class="form-input" required>
            <option value="" disabled selected>Seleccione un rango...</option>
            <option value="menos-de-10000">Menos de $10,000 MXN</option>
            <option value="10000-25000">$10,000 - $25,000 MXN</option>
            <option value="25000-50000">$25,000 - $50,000 MXN</option>
            <option value="50000-mas">$50,000 MXN o más</option>
          </select>
        </div>
        <div class="text-center mt-10">
          <button type="submit" class="btn-primary">
            Enviar Aplicación
          </button>
        </div>
      </form>

      <div id="form-status" class="mt-10" style="display: none;"> 
          {/* */}
      </div>

    </div>
  </section>
</Layout>

<script>
  const form = document.getElementById('aplicacion-form');
  const statusDiv = document.getElementById('form-status');

  async function handleSubmit(event) {
    event.preventDefault(); 
    const formData = new FormData(event.target);
    
    statusDiv.style.display = 'block';
    statusDiv.innerHTML = '<p class="text-lg text-secundario">Enviando aplicación...</p>';
    statusDiv.classList.remove('success', 'error'); 

    try {
      const response = await fetch(event.target.action, {
        method: form.method,
        body: formData,
        headers: {
            'Accept': 'application/json' 
        }
      });

      if (response.ok) {
        statusDiv.innerHTML = `
          <div class="success-message">
            <h2 class="text-2xl font-playfair font-bold text-oscuro mb-4">¡Aplicación Recibida!</h2>
            <p class="text-lg text-secundario mb-6">
              Nuestro equipo revisará sus respuestas. Si determinamos que existe potencial, <strong>nos pondremos en contacto</strong> en 24-48 horas hábiles.
            </p>
            <a 
              href="https://www.linkedin.com/in/marcoportillo-pixelarte/" 
              class="btn-primary" 
              target="_blank" 
              rel="noopener noreferrer"
            >
              Conectar con Marco A. Portillo en LinkedIn
            </a>
          </div>
        `;
        statusDiv.classList.add('success'); 
        form.reset(); 
        form.style.display = 'none'; 
      } else {
        response.json().then(data => {
          let errorMessage = "Oops! Hubo un problema al enviar tu aplicación.";
          if (data.errors) {
            errorMessage += `<br/> ${data.errors.map(error => error.message).join('<br/>')}`;
          }
          statusDiv.innerHTML = `<p class="error-message">${errorMessage}</p>`;
          statusDiv.classList.add('error'); 
        })
      }
    } catch (error) {
      statusDiv.innerHTML = '<p class="error-message">Oops! Hubo un problema de conexión. Por favor, inténtalo de nuevo.</p>';
      statusDiv.classList.add('error'); 
    }
  }

  form.addEventListener("submit", handleSubmit);
</script>
<style>
  .success-message {
    border: 2px solid #22c55e; /* Verde */
    background-color: #f0fdf4;
    padding: 2rem;
    border-radius: 0.5rem;
  }
  .error-message {
    color: #dc2626; /* Rojo */
    font-weight: bold;
    border: 2px solid #dc2626;
    background-color: #fef2f2;
    padding: 1rem;
    border-radius: 0.5rem;
  }
</style>