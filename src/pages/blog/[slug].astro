---
// src/pages/blog/[slug].astro
import Layout from '../../layouts/Layout.astro';
import { CollectionEntry, getCollection, getEntryBySlug } from 'astro:content';

export const prerender = true; 

// 1. getStaticPaths (Sin cambios)
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
  }));
}

// 2. Get slug y Fetch
const { slug } = Astro.params;
const post = slug ? await getEntryBySlug('blog', slug) : undefined;

if (!post) {
  return Astro.redirect('/404/');
}

// 3. Render
const { Content } = await post.render();

// 4. Extract data
const { title, description, pubDate, author, image } = post.data;

// 5. Definir la URL de la OG Image
const ogImageUrl = image?.url; 
const ogImageAlt = image?.alt;
const canonicalUrl = new URL(Astro.url.pathname, Astro.site).href;
---

<Layout 
  title={`${title} | Blog Pixelarte Studio`} 
  description={description}
  ogImage={ogImageUrl} 
  ogImageAlt={ogImageAlt} 
  canonicalUrl={canonicalUrl}
>
  <article class="bg-claro py-16 md:py-24">
    <div class="container max-w-3xl mx-auto px-4">
      
      <header class="mb-10 text-center border-b border-borde-claro pb-6">
        {/* Título principal del post */}
        <h1 class="blog-title font-playfair font-bold text-oscuro mb-4">
          {title}
        </h1>
        <p class="text-secundario">
          Por {author} | Publicado el {new Date(pubDate).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
        </p>
      </header>

      {image && image.url && (
        <img 
          src={image.url} 
          alt={image.alt || ''} 
          class="rounded-lg mb-10 w-full aspect-video object-cover shadow-md" 
          width="800" 
          height="450"
          loading="lazy"
          decoding="async"
        />
      )}

      {/* Contenido del post */}
      <div class="prose max-w-none">
        <Content /> 
      </div>

       <div class="text-center mt-10 pt-6 border-t border-borde-claro">
          <a href="/blog/" class="btn-primary">&larr; Volver al Blog</a>
       </div>

    </div>
  </article>
</Layout>

{/* ===== INICIO DEL CAMBIO: Estilos Mobile-First CORREGIDOS ===== */}
<style is:global>
  /* Título principal H1 */
  .blog-title {
    font-size: 2.25rem; /* 36px - Tamaño base para móvil (CORREGIDO) */
    line-height: 1.2;
    word-wrap: break-word; /* Asegura que el texto se rompa si es necesario */
  }
  
  .prose {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-texto-secundario);
  }
  
  /* Subtítulos H2 */
  .prose h2 {
    font-size: 1.5rem; /* 24px - Tamaño base para móvil */
    color: var(--color-texto-oscuro);
    margin-top: 2.5em;
    margin-bottom: 1em;
    font-family: 'Playfair Display', serif;
    padding-bottom: 0.3em;
    border-bottom: 1px solid var(--color-borde-claro);
  }
  
  /* Subtítulos H3 */
  .prose h3 {
    font-size: 1.25rem; /* 20px - Tamaño base para móvil */
    color: var(--color-texto-oscuro);
    margin-top: 2em;
    margin-bottom: 1em;
     font-family: 'Playfair Display', serif;
  }

  /* Estilos Desktop: Hacemos los títulos más grandes solo en pantallas > 768px */
  @media (min-width: 768px) {
    .blog-title {
      font-size: 3rem; /* 48px - Tamaño desktop original */
    }
    .prose h2 {
      font-size: 1.875rem; /* 30px - Tamaño desktop */
    }
    .prose h3 {
      font-size: 1.5rem; /* 24px - Tamaño desktop */
    }
  }
  
  /* ... (Resto de estilos .prose sin cambios) ... */
  .prose p { margin-bottom: 1.25em; word-wrap: break-word; }
  .prose a { color: var(--color-acento); text-decoration: underline; transition: color 0.2s ease; }
  .prose a:hover { color: #1D4ED8; }
  .prose strong { font-weight: 700; color: var(--color-texto-oscuro); }
  .prose ul, .prose ol { margin-left: 1.5em; margin-bottom: 1.25em; padding-left: 1em; }
  .prose li { margin-bottom: 0.5em; }
  .prose li > p { margin-bottom: 0.5em; }
  .prose blockquote { border-left: 4px solid var(--color-acento); padding-left: 1em; margin-left: 0; margin-right: 0; font-style: italic; color: var(--color-texto-secundario); background-color: #f9fafb; padding-top: 0.5em; padding-bottom: 0.5em; }
  .prose img { max-width: 100%; height: auto; border-radius: 0.5rem; margin-top: 2em; margin-bottom: 2em; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
  .prose code { background-color: #e5e7eb; color: var(--color-texto-oscuro); padding: 0.2em 0.4em; border-radius: 0.25rem; font-size: 0.9em; font-family: monospace; }
  .prose pre { background-color: var(--color-oscuro-contraste); color: var(--color-texto-claro); padding: 1em; border-radius: 0.5rem; overflow-x: auto; font-family: monospace; }
  .prose pre code { background-color: transparent; color: inherit; padding: 0; font-size: inherit; }
</style>
{/* ===== FIN DEL CAMBIO ===== */}